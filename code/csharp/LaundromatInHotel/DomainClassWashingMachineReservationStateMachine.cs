// ------------------------------------------------------------------------------
// <auto-generated>
//     This file is generated by tool.
//     Runtime Version : 0.1.0
//  
//     Updates this file cause incorrect behavior 
//     and will be lost when the code is regenerated.
// </auto-generated>
// ------------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using System.Linq;
using Kae.StateMachine;
using Kae.Utility.Logging;
using Kae.DomainModel.Csharp.Framework;

namespace LaundromatInHotel
{
    public partial class DomainClassWashingMachineReservationStateMachine : StateMachineBase, ITransition
    {
        public enum Events
        {
            WashingMachineReservation1 = 0,     // Try to reserve
            WashingMachineReservation2 = 1,     // Assigned
            WashingMachineReservation3 = 2,     // Pre alarm is time up
            WashingMachineReservation4 = 3,     // Time is up
            WashingMachineReservation5 = 4,     // Canceled
            WashingMachineReservation6 = 5    // Rejected
        }

        public enum States
        {
            _NoState_ = 0,
            WaitForAssignment = 1,
            Reserved = 2,
            PreNotified = 3,
            WashingMachineIsAssigned = 4,
            Canceled = 5,
            NoWashingMachine = 6
        }

        private interface IEventArgsSpecIdGuestStayIdReservationTimeDef
        {
            public string specId { get; set; }
            public string guestStayId { get; set; }
            public DateTime reservationTime { get; set; }
        }
        public class WashingMachineReservation1_TryToReserve : EventData, IEventArgsSpecIdGuestStayIdReservationTimeDef
        {
            DomainClassWashingMachineReservation reciever;

            public WashingMachineReservation1_TryToReserve(DomainClassWashingMachineReservation reciever) : base((int)Events.WashingMachineReservation1)
            {
                this.reciever = reciever;
            }

            public override void Send()
            {
                reciever.TakeEvent(this);
            }

            public string specId { get; set; }
            public string guestStayId { get; set; }
            public DateTime reservationTime { get; set; }
            public static WashingMachineReservation1_TryToReserve Create(DomainClassWashingMachineReservation receiver, string specId, string guestStayId, DateTime reservationTime, bool sendNow, InstanceRepository instanceRepository, Logger logger)
            {
                var newEvent = new WashingMachineReservation1_TryToReserve(receiver) { specId = specId, guestStayId = guestStayId, reservationTime = reservationTime };
                if (receiver == null && instanceRepository != null)
                {
                    receiver = DomainClassWashingMachineReservationBase.CreateInstance(instanceRepository, logger);
                }
                if (sendNow)
                {
                    receiver.TakeEvent(newEvent);
                }

                return newEvent;
            }
        }

        public class WashingMachineReservation2_Assigned : EventData
        {
            DomainClassWashingMachineReservation reciever;

            public WashingMachineReservation2_Assigned(DomainClassWashingMachineReservation reciever) : base((int)Events.WashingMachineReservation2)
            {
                this.reciever = reciever;
            }

            public override void Send()
            {
                reciever.TakeEvent(this);
            }

            public static WashingMachineReservation2_Assigned Create(DomainClassWashingMachineReservation receiver, bool sendNow)
            {
                var newEvent = new WashingMachineReservation2_Assigned(receiver);
                if (receiver != null)
                {
                    if (sendNow)
                    {
                        receiver.TakeEvent(newEvent);
                    }
                }

                return newEvent;
            }
        }

        public class WashingMachineReservation3_PreAlarmIsTimeUp : EventData
        {
            DomainClassWashingMachineReservation reciever;

            public WashingMachineReservation3_PreAlarmIsTimeUp(DomainClassWashingMachineReservation reciever) : base((int)Events.WashingMachineReservation3)
            {
                this.reciever = reciever;
            }

            public override void Send()
            {
                reciever.TakeEvent(this);
            }

            public static WashingMachineReservation3_PreAlarmIsTimeUp Create(DomainClassWashingMachineReservation receiver, bool sendNow)
            {
                var newEvent = new WashingMachineReservation3_PreAlarmIsTimeUp(receiver);
                if (receiver != null)
                {
                    if (sendNow)
                    {
                        receiver.TakeEvent(newEvent);
                    }
                }

                return newEvent;
            }
        }

        public class WashingMachineReservation4_TimeIsUp : EventData
        {
            DomainClassWashingMachineReservation reciever;

            public WashingMachineReservation4_TimeIsUp(DomainClassWashingMachineReservation reciever) : base((int)Events.WashingMachineReservation4)
            {
                this.reciever = reciever;
            }

            public override void Send()
            {
                reciever.TakeEvent(this);
            }

            public static WashingMachineReservation4_TimeIsUp Create(DomainClassWashingMachineReservation receiver, bool sendNow)
            {
                var newEvent = new WashingMachineReservation4_TimeIsUp(receiver);
                if (receiver != null)
                {
                    if (sendNow)
                    {
                        receiver.TakeEvent(newEvent);
                    }
                }

                return newEvent;
            }
        }

        public class WashingMachineReservation5_Canceled : EventData
        {
            DomainClassWashingMachineReservation reciever;

            public WashingMachineReservation5_Canceled(DomainClassWashingMachineReservation reciever) : base((int)Events.WashingMachineReservation5)
            {
                this.reciever = reciever;
            }

            public override void Send()
            {
                reciever.TakeEvent(this);
            }

            public static WashingMachineReservation5_Canceled Create(DomainClassWashingMachineReservation receiver, bool sendNow)
            {
                var newEvent = new WashingMachineReservation5_Canceled(receiver);
                if (receiver != null)
                {
                    if (sendNow)
                    {
                        receiver.TakeEvent(newEvent);
                    }
                }

                return newEvent;
            }
        }

        public class WashingMachineReservation6_Rejected : EventData
        {
            DomainClassWashingMachineReservation reciever;

            public WashingMachineReservation6_Rejected(DomainClassWashingMachineReservation reciever) : base((int)Events.WashingMachineReservation6)
            {
                this.reciever = reciever;
            }

            public override void Send()
            {
                reciever.TakeEvent(this);
            }

            public static WashingMachineReservation6_Rejected Create(DomainClassWashingMachineReservation receiver, bool sendNow)
            {
                var newEvent = new WashingMachineReservation6_Rejected(receiver);
                if (receiver != null)
                {
                    if (sendNow)
                    {
                        receiver.TakeEvent(newEvent);
                    }
                }

                return newEvent;
            }
        }

        protected DomainClassWashingMachineReservation target;

        protected InstanceRepository instanceRepository;

        public DomainClassWashingMachineReservationStateMachine(DomainClassWashingMachineReservation target, InstanceRepository instanceRepository, Logger logger) : base(0, logger)
        {
            this.target = target;
            this.stateTransition = this;
            this.logger = logger;
            this.instanceRepository = instanceRepository;
        }

        protected int[,] stateTransitionTable = new int[6, 6]
            {
                { (int)ITransition.Transition.CantHappen, (int)States.Reserved, (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)States.NoWashingMachine }, 
                { (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)States.PreNotified, (int)ITransition.Transition.CantHappen, (int)States.Canceled, (int)ITransition.Transition.CantHappen }, 
                { (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)States.WashingMachineIsAssigned, (int)States.Canceled, (int)ITransition.Transition.CantHappen }, 
                { (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)States.Canceled, (int)ITransition.Transition.CantHappen }, 
                { (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.Ignore, (int)ITransition.Transition.Ignore, (int)ITransition.Transition.Ignore, (int)ITransition.Transition.Ignore, (int)ITransition.Transition.Ignore }, 
                { (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.CantHappen, (int)ITransition.Transition.Ignore, (int)ITransition.Transition.CantHappen }
            };

        public int GetNextState(int currentState, int eventNumber)
        {
            return stateTransitionTable[currentState, eventNumber];
        }

        private List<ChangedState> changedStates;

        protected override void RunEntryAction(int nextState, EventData eventData)
        {
            if (logger != null) logger.LogInfo($"@{DateTime.Now.ToString("yyyyMMddHHmmss.fff")}:WashingMachineReservation(ReservationID={target.Attr_ReservationID}):entering[current={CurrentState},event={eventData.EventNumber}");


            changedStates = new List<ChangedState>();

            switch (nextState)
            {
            case (int)States.WaitForAssignment:
                ActionWaitForAssignment(((IEventArgsSpecIdGuestStayIdReservationTimeDef)eventData).specId, ((IEventArgsSpecIdGuestStayIdReservationTimeDef)eventData).guestStayId, ((IEventArgsSpecIdGuestStayIdReservationTimeDef)eventData).reservationTime);
                break;
            case (int)States.Reserved:
                ActionReserved();
                break;
            case (int)States.PreNotified:
                ActionPreNotified();
                break;
            case (int)States.WashingMachineIsAssigned:
                ActionWashingMachineIsAssigned();
                break;
            case (int)States.Canceled:
                ActionCanceled();
                break;
            case (int)States.NoWashingMachine:
                ActionNoWashingMachine();
                break;
            }
            if (logger != null) logger.LogInfo($"@{DateTime.Now.ToString("yyyyMMddHHmmss.fff")}:WashingMachineReservation(ReservationID={target.Attr_ReservationID}):entered[current={CurrentState},event={eventData.EventNumber}");


            instanceRepository.SyncChangedStates(changedStates);
        }
    }
}
